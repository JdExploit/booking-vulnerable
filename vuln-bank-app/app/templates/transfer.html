{% extends "base.html" %}

{% block title %}Transfer Funds - SecureBank{% endblock %}

{% block content %}
    
    <div class="container">
        <h2>Money Transfer</h2>
        
        {# Mensajes de éxito o error deben ser pasados desde Flask #}
        {% if message %}
            <p style="color: green; font-weight: bold; text-align: center;">{{ message }}</p>
        {% elif error %}
            <p style="color: red; font-weight: bold; text-align: center;">{{ error }}</p>
        {% endif %}
        
        <form action="/transfer" method="POST" id="transferForm">
            <div class="form-group">
                <label for="from_account">From Account:</label>
                {# Asumiendo que 'session' está disponible en la plantilla #}
                <input type="text" id="from_account" name="from_account" 
                       value="{{ session.get('username', 'N/A') }}" readonly>
            </div>
            
            <div class="form-group">
                <label for="to_account">To Account:</label>
                <input type="text" id="to_account" name="to_account" required 
                       placeholder="Enter recipient username">
            </div>
            
            <div class="form-group">
                <label for="amount">Amount ($):</label>
                <input type="number" id="amount" name="amount" 
                       step="0.01" min="0.01" required>
            </div>
            
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea id="description" name="description" 
                          placeholder="Optional description"></textarea>
            </div>
            
            <input type="hidden" name="session_id" value="{{ session.get('user_id') }}">
            
            <button type="submit">Transfer Funds</button>
        </form>
        
        <div class="security-warning">
            <h4>⚠️ Security Note (CSRF Test):</h4>
            <p>Always verify recipient details before transferring. This page is vulnerable to external requests.</p>
            
            {# Este script contiene la lógica de prueba de vulnerabilidad #}
            <script>
                // Exponer información de sesión
                document.getElementById('debugInfo').innerHTML = 
                    'Session ID: ' + '{{ session.get("user_id") }}';
                
                // Función vulnerable a inyección (de JS) - NUNCA usar eval() con entrada no segura.
                function validateInput(input) {
                    return eval('"' + input + '"');
                }
            </script>
            <p id="debugInfo"></p>
        </div>
        
        <div class="quick-links">
            <h4>Quick Actions (IDOR/SQLi Tests):</h4>
            <a href="/user/profile/1">View Admin Profile (IDOR)</a>
            <a href="/user/profile/2">View Alice Profile (IDOR)</a>
            <a href="/search?q=">Find Users (SQLi)</a>
        </div>
    </div>
{% endblock %}
